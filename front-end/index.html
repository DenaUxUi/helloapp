<!DOCTYPE html>
<html>

<head>
  <title>API Tester</title>
</head>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 500px;
    margin: 50px auto;
    max-height: 100vh;
    height: 90vh;

    display: flex;
    align-items: center;
    justify-content: center;

    background-repeat: no-repeat;

    background-size: cover;

    background-image: url("./pic.jpg");
  }

  .box {
    background-color: #ffffff20;

    width: 460px;
    border-radius: 12px;
    padding: 24px;

    overflow: hidden;

    color: white;
    border: 1.5px solid #ffffff25;

    box-shadow: 1px 2px 15px #00000035;
  }

  button {
    max-width: 100%;
    width: 100%;
    margin: 10px 0;
    padding: 8px;
    font-size: 16px;

    border-radius: 12px;
    border: 2px solid #ffffff;
    background: #ffffff00;
    color: white;
    transition: 0.4s;
  }

  button:hover,
  button:focus {
    transform: scale(1.009);
  }

  input,
  textarea {
    border-radius: 12px;
    max-width: 100%;
    width: 440px;
    margin: 10px 0;
    padding: 8px;
    font-size: 16px;

    border: 0px;
  }

  textarea {
    height: 100px;
    resize: none;
  }
</style>

<body>
  <div class="box">
    <h1>API Hello Tester</h1>
    <label>API Endpoint:</label>
    <input type="text" id="endpoint" value="http://127.0.0.1:8080" /><br />

    <label>Your Name:</label>
    <input type="text" id="name" /><br />

    <button onclick="sendRequest()">Submit</button>
    <button onclick="createInstance()">Create instance</button>
    <button onclick="getList()">Get list</button>
    <select id="instanceList"></select>
    <button onclick="deleteInstance()">Delete instance</button>

    <h3>Server response:</h3>
    <textarea id="response" cols="50" rows="5" readonly></textarea>
  </div>

  <script>
    async function sendRequest() {
      const endpoint = document.getElementById("endpoint").value + "/api/hello";
      const name = document.getElementById("name").value;

      if (!endpoint || !name) {
        alert("Please provide both endpoint and name.");
        return;
      }

      const payload = { name };

      try {
        const response = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: JSON.stringify(payload),
        });

        if (!response.ok)
          throw new Error("Request failed: " + response.status);

        const data = await response.json();
        document.getElementById("response").value =
          data.message || JSON.stringify(data);
      } catch (err) {
        document.getElementById("response").value = err;
      }
    }

    async function createInstance() {
      const endpoint = document.getElementById("endpoint").value + "/api/ec2/create";

      try {
        const response = await fetch(endpoint, { method: "GET" });

        if (!response.ok)
          throw new Error("Request failed: " + response.status);

        const data = await response.json();
        document.getElementById("response").value =
          data.message || JSON.stringify(data);
      } catch (err) {
        document.getElementById("response").value = err;
      }
    }

    async function getList() {
      const endpoint = document.getElementById("endpoint").value + "/api/ec2/list";

      try {
        const response = await fetch(endpoint, { method: "GET" });

        if (!response.ok)
          throw new Error("Request failed: " + response.status);

        const data = await response.json();
        const select = document.getElementById("instanceList");
        select.innerHTML = "";

        // Используем data.instances как массив строк
        if (Array.isArray(data.instances)) {
          data.instances.forEach((id) => {
            const option = document.createElement("option");
            option.value = id;
            option.text = id;
            select.appendChild(option);
          });
        } else {
          throw new Error("Invalid response format: instances is not an array");
        }

        document.getElementById("response").value = JSON.stringify(data);
      } catch (err) {
        document.getElementById("response").value = err;
      }
    }


    async function deleteInstance() {
      const endpointBase = document.getElementById("endpoint").value;
      const select = document.getElementById("instanceList");
      const selectedIndex = select.selectedIndex;

      if (selectedIndex === -1) {
        alert("Please select an instance to delete.");
        return;
      }

      const endpoint = `${endpointBase}/api/ec2/terminate/${selectedIndex}`;

      try {
        const response = await fetch(endpoint, { method: "GET" });

        if (!response.ok)
          throw new Error("Request failed: " + response.status);

        const data = await response.json();
        document.getElementById("response").value =
          data.message || JSON.stringify(data);
      } catch (err) {
        document.getElementById("response").value = err;
      }
    }

  </script>
</body>

</html>